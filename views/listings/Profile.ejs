<% layout('/layouts/boilerplate') %>
    <div class="container py-5">
        <h1 class="fw-bold mb-4">My Profile</h1>

        <!-- Profile Card -->
        <div class="card shadow p-4 mb-4">
            <div class="d-flex align-items-center">
                <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center"
                    style="width: 80px; height: 80px; font-size: 35px;">
                    <i class="bi bi-person"></i>
                </div>
                <div class="ms-3">
                    <h4 class="mb-1">
                        <%= user.username %>
                    </h4>
                    <p class="mb-1"><i class="bi bi-envelope"></i>
                        <%= user.email %>
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="row text-center mb-4">
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm p-4 h-100">
                    <i class="bi bi-house fs-2 mb-2"></i>
                    <h5>
                        <%= myListings.length %>
                    </h5>
                    <p class="text-muted">Properties Listed</p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm p-4 h-100">
                    <i class="bi bi-star fs-2 mb-2"></i>
                    <h5>4.8</h5>
                    <p class="text-muted">Average Rating</p>
                </div>
            </div>
        </div>

        <!-- My Properties -->
        <h2 class="mb-3">My Listings</h2>

        <% if (myListings.length===0) { %>
            <p>You havenâ€™t created any listings yet.</p>
            <% } else { %>
                <div class="row g-4">
                    <% myListings.forEach(listing=> { %>
                        <div class="col-lg-4 col-md-6 col-sm-12 featured-card">
                            <div class="card shadow-sm border-0 rounded-4 overflow-hidden h-100">

                                <!-- Image with Badge & Hover Eye -->
                                <div class="position-relative listing-card">
                                    <a href="/listings/<%= listing._id %>">
                                        <img src="<%= (listing.images && listing.images.length > 0) ? listing.images[0].url : '/images/default-placeholder.png' %>"
                                            class="card-img-top" alt="<%= listing.title %>"
                                            style="height: 18rem; object-fit: cover;">
                                    </a>

                                    <!-- Badge -->
                                    <span
                                        class="badge bg-dark position-absolute top-0 start-0 m-2 px-3 py-1 rounded-pill">
                                        <%= listing.Type || "NXTDoor" %>
                                    </span>

                                    <!-- Hover Eye Overlay -->
                                    <a href="/listings/<%= listing._id %>" class="eye-overlay">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                </div>

                                <!-- Card Body -->
                                <div class="card-body mt-3">
                                    <h5 class="card-title fw-bold mb-2">
                                        <%= listing.title %>
                                    </h5>
                                    <p class="text-muted small mb-2">
                                        <i class="fa fa-calendar"></i>
                                        <%= new Date(listing.createdAt).toLocaleDateString("en-US", { year: "numeric" ,
                                            month: "short" , day: "numeric" }) %>
                                    </p>
                                    <% if (listing.price) { %>
                                        <p class="text-secondary mb-1">&#8377; <%= listing.price.toLocaleString("en-IN")
                                                %>
                                        </p>
                                        <% } %>
                                            <p class="card-text text-secondary">
                                                <%= listing.description ? (listing.description.length> 80
                                                    ? listing.description.substring(0, 80) + "..."
                                                    : listing.description)
                                                    : "No description available" %>
                                            </p>
                                </div>

                                <!-- Card Footer -->
                                <div class="card-footer bg-white border-0 d-flex justify-content-between">
                                    <a href="#" class="text-danger"><i class="fa fa-heart"></i></a>
                                    <a href="/listings/<%= listing._id %>" class="text-secondary"><i
                                            class="fa fa-eye"></i></a>
                                </div>
                            </div>
                        </div>
                        <% }) %>
                </div>
                <% } %>
                    <div
                        class="card shadow-sm p-4 d-flex flex-row justify-content-between align-items-center rounded-4 border-0 mt-5">
                        <!-- Left Side -->
                        <div>
                            <h5 class="fw-bold mb-1">Sign Out</h5>
                            <p class="text-muted mb-0">Sign out of your account on this device</p>
                        </div>

                        <!-- Right Side -->
                        <a href="/logout"
                            class="btn btn-outline-dark d-flex align-items-center gap-2 rounded-pill px-4">
                            <i class="fa-solid fa-right-from-bracket"></i> Sign Out
                        </a>
                    </div>

    </div>